/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ§  Decision Core Integrated - Ù†ÙˆØ§Ø© Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * Ù†ÙˆØ§Ø© Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© Ù…Ø¹ APIs Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
 * ØªØ³ØªØ®Ø¯Ù… Ù„Ù‡Ø¬Ø© Ø³Ø¹ÙˆØ¯ÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆÙ†Ø¨Ø±Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©
 * 
 * Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:
 * - Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª API Ø­Ù‚ÙŠÙ‚ÙŠØ©
 * - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª (Disambiguation)
 * - Ø¥Ø®Ø±Ø§Ø¬ Actions Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°
 * - Ù„Ù‡Ø¬Ø© Ø³Ø¹ÙˆØ¯ÙŠØ© Ø£ØµÙŠÙ„Ø©
 * 
 * ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: 5 Ù†ÙˆÙÙ…Ø¨Ø± 2025
 * Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 5 Ù†ÙˆÙÙ…Ø¨Ø± 2025
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

import Api from '../../services/apiClients';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ­ TONE HELPERS - Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø§Ù„Ù†Ø¨Ø±Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Ù†Ø¨Ø±Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ (Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©)
 */
function toneConfirm(txt: string): string {
  return `âœ… Ø§Ø¨Ø´Ø± Ø·Ø§Ù„ Ø¹Ù…Ø±ÙƒØŒ ${txt}`;
}

/**
 * Ù†Ø¨Ø±Ø© Ù…Ø­Ø§ÙŠØ¯Ø©
 */
function toneNeutral(txt: string): string {
  return `Ø·Ø§Ù„ Ø¹Ù…Ø±Ùƒ ${txt}`;
}

/**
 * ØªØ­ÙŠØ© ØªØ±Ø­ÙŠØ¨ÙŠØ©
 */
function greeting(): string {
  return 'Ø³Ù… Ø·Ø§Ù„ Ø¹Ù…Ø±Ùƒ ğŸŒŸØŒ ÙƒÙŠÙ Ø£Ù‚Ø¯Ø± Ø£Ø®Ø¯Ù…ÙƒØŸ';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ” TEXT ANALYSIS HELPERS - Ù…Ø³Ø§Ø¹Ø¯Ø§Øª ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ù†Øµ
 * @param text - Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„
 * @returns Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ Ø£Ùˆ null
 */
function extractName(text: string): string | null {
  const m = text.match(/([Ø¡-ÙŠA-Za-z]{2,}\s?[Ø¡-ÙŠA-Za-z]{0,})/i);
  return m ? m[0].trim() : null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ RESULT HANDLERS - Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù†ØªØ§Ø¦Ø¬
 * @param entity - Ù†ÙˆØ¹ Ø§Ù„ÙƒÙŠØ§Ù† (customer, offer, etc.)
 * @param query - Ù†Øµ Ø§Ù„Ø¨Ø­Ø«
 * @returns Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
 */
function handleNoResults(entity: string, query: string): string {
  if (entity === 'customer') {
    return `Ù…Ø§ Ù„Ù‚ÙŠØª Ø§Ù„Ø¹Ù…ÙŠÙ„ "${query}". Ø¬Ø±Ø¨:\n1) Ø§ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ â†’ Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…\n2) Ø¥Ø°Ø§ Ù…Ø§ Ø·Ù„Ø¹ ÙÙ‡Ùˆ Ø¨Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø£Ùˆ Ù…Ø­Ø°ÙˆÙ.\n\nØ£Ø¨ÙŠ Ø£Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ù„ÙƒØŸ`;
  }
  return `Ù…Ø§ Ù„Ù‚ÙŠØª Ù†ØªÙŠØ¬Ø© Ù„Ù€ "${query}".`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ MAIN DECISION CORE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const DecisionCoreIntegrated = {
  /**
   * Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
   * @param userId - Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
   * @param input - Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„
   * @param context - Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
   * @returns Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø¹ Actions
   */
  async handle(userId: string, input: string, context: any = {}) {
    const text = (input || '').trim();
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„ÙØ§Ø±Øº
    if (!text) {
      return { 
        intent: 'empty', 
        confidence: 0, 
        reply: 'Ø·Ø§Ù„ Ø¹Ù…Ø±Ùƒ Ù…Ø§ Ø§Ø³ØªÙ„Ù…Øª Ø£ÙŠ Ù†Øµ.' 
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 1ï¸âƒ£ Ø§Ù„ØªØ­ÙŠØ© ÙˆØ§Ù„ØªØ±Ø­ÙŠØ¨
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/^(Ù‡Ù„Ø§|Ù…Ø±Ø­Ø¨Ø§|Ø§Ù„Ø³Ù„Ø§Ù…|Ø³Ù…|Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…|ØµØ¨Ø§Ø­|Ù…Ø³Ø§Ø¡)/i.test(text)) {
      return { 
        intent: 'greeting', 
        confidence: 0.98, 
        reply: greeting() 
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 2ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡/Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ø­Ù‚ÙŠÙ‚ÙŠ)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/\b(Ù…ÙˆØ¹Ø¯|Ø­Ø¬Ø²|Ø§Ø­Ø¬Ø²|Ø£Ø¨ØºÙ‰ Ù…ÙˆØ¹Ø¯|Ø§Ù†Ø´Ø¦ Ù…ÙˆØ¹Ø¯|Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ¹Ø¯)\b/i.test(text)) {
      const name = extractName(text);
      
      if (name) {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„
        const matches = await Api.searchCustomersAPI(name).catch(() => []);
        
        if (!matches || matches.length === 0) {
          // Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…ÙŠÙ„
          const reply = toneNeutral(`Ù…Ø§ Ù„Ù‚ÙŠØª Ø£ÙŠ Ø¹Ù…ÙŠÙ„ Ø¨Ø§Ø³Ù… "${name}". ${handleNoResults('customer', name)}`);
          return { 
            intent: 'addAppointment', 
            confidence: 0.9, 
            reply, 
            actions: [
              { label: 'ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', action: 'open_clients' }
            ] 
          };
        } else if (matches.length === 1) {
          // Ø¹Ù…ÙŠÙ„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
          const cust = matches[0];
          const reply = toneConfirm(`Ø±Ø§Ø­ Ø£ÙØªØ­ Ù„Ùƒ ÙˆØ§Ø¬Ù‡Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ¹Ø¯ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${cust.name}. ØªØ¨ÙŠ ØªØ­Ø¯Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¢Ù†ØŸ`);
          return {
            intent: 'addAppointment',
            confidence: 0.96,
            data: { customer: cust },
            actions: [
              { 
                label: 'ÙØªØ­ Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ¹Ø¯', 
                action: 'create_appointment', 
                params: { customerId: cust.id } 
              }
            ],
            reply
          };
        } else {
          // Ø¹Ø¯Ø© Ø¹Ù…Ù„Ø§Ø¡
          const reply = toneNeutral(`ÙÙŠ Ø£ÙƒØ«Ø± Ù…Ù† Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø§Ø³Ù… "${name}". Ø§Ø®ØªÙØ± Ø£ÙŠ ÙˆØ§Ø­Ø¯ Ù…Ù†Ù‡Ù…:`);
          const actions = matches.map((m: any) => ({ 
            label: m.name, 
            action: 'open_customer_card', 
            params: { customerId: m.id } 
          }));
          return { 
            intent: 'disambiguate_customer', 
            confidence: 0.95, 
            data: matches, 
            reply, 
            actions 
          };
        }
      } else {
        // Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù…
        const reply = toneConfirm('ØªÙ… ÙØªØ­ Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯. Ø­Ø¯Ù‘Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ùˆ ØªØ¨ÙŠ Ø£Ø­Ø¬Ø² Ù„Ø¹Ù…ÙŠÙ„.');
        return { 
          intent: 'addAppointment', 
          confidence: 0.9, 
          reply, 
          actions: [
            { label: 'ÙØªØ­ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯', action: 'create_appointment' }
          ] 
        };
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 3ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ø­Ù‚ÙŠÙ‚ÙŠ)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/\b(Ø§Ø¨Ø­Ø« Ø¹Ù†|Ø¯ÙˆØ± Ø¹Ù„Ù‰|Ø§Ø¨Ø­Ø«|ÙÙŠÙ†|ÙˆÙŠÙ†|Ø£ÙŠÙ†)\b/i.test(text) && 
        /\b(Ø¹Ù…ÙŠÙ„|Ø§Ø³Ù…|Ø²Ø¨ÙˆÙ†|Ø´Ø®Øµ)\b/i.test(text)) {
      
      const name = extractName(text) || text;
      const matches = await Api.searchCustomersAPI(name).catch(() => []);
      
      if (!matches || matches.length === 0) {
        // Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬
        const reply = toneNeutral(handleNoResults('customer', name));
        return { 
          intent: 'search_customers', 
          confidence: 0.9, 
          reply, 
          actions: [
            { label: 'ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', action: 'open_clients' }, 
            { label: 'Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ', action: 'search_archive', params: { query: name } }
          ] 
        };
      } else if (matches.length === 1) {
        // Ø¹Ù…ÙŠÙ„ ÙˆØ§Ø­Ø¯
        const c = matches[0];
        const reply = toneConfirm(`${c.name} Ù…ÙˆØ¬ÙˆØ¯ â€” ØªØ¨ÙŠ Ø§ÙØªØ­ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø£Ø­Ø¬Ø² Ù„Ù‡ Ù…ÙˆØ¹Ø¯ØŸ`);
        return { 
          intent: 'search_customers', 
          confidence: 0.95, 
          data: c, 
          reply, 
          actions: [
            { 
              label: 'Ø§ÙØªØ­ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„', 
              action: 'open_customer_card', 
              params: { customerId: c.id } 
            }, 
            { 
              label: 'Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ù„Ù‡', 
              action: 'create_appointment', 
              params: { customerId: c.id } 
            }
          ] 
        };
      } else {
        // Ø¹Ø¯Ø© Ø¹Ù…Ù„Ø§Ø¡
        const reply = toneNeutral(`ÙÙŠ ${matches.length} Ù†ØªÙŠØ¬Ø© ØªØ·Ø§Ø¨Ù‚ "${name}". Ø§Ø®ØªÙØ± ÙˆØ§Ø­Ø¯:`);
        const actions = matches.map((m: any) => ({ 
          label: m.name, 
          action: 'open_customer_card', 
          params: { customerId: m.id } 
        }));
        return { 
          intent: 'search_customers', 
          confidence: 0.93, 
          data: matches, 
          reply, 
          actions 
        };
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 4ï¸âƒ£ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙ†Ù‚Ù„ / Ø¹Ø¯Ù… Ø¥ÙŠØ¬Ø§Ø¯
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/\b(Ù…Ø§ Ø­ØµÙ„Øª|Ù…Ø§ Ù„Ù‚ÙŠØª|Ù…Ø§ ØµØ§Ø±|Ù…Ø§ Ø§Ù†Ù‚Ù„|Ù…Ø§ Ù†ÙÙ‚Ù„Øª|Ø¶Ø§ÙŠØ¹|ØªØ§ÙŠÙ‡)\b/i.test(text)) {
      const reply = toneNeutral('ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ù…Ø§ Ø­ØµÙ„Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨. ØªØ¨ÙŠ Ø£Ø¯Ø®Ù„ Ù„Ùƒ Ø¹Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø£Ùˆ Ø£Ø¨Ø­Ø« Ø¨Ø§Ù„Ø£Ø±Ø´ÙŠÙØŸ');
      return { 
        intent: 'navigation_issue', 
        confidence: 0.9, 
        reply, 
        actions: [
          { label: 'ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', action: 'open_clients' }, 
          { label: 'Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ', action: 'search_archive' }
        ] 
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 5ï¸âƒ£ Ø§Ù„Ø¹Ø±ÙˆØ¶ (Ù†Ù…Ø§Ø°Ø¬ - ØªØ³ØªØ¯Ø¹ÙŠ API Ø­Ù‚ÙŠÙ‚ÙŠ)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/\b(Ø¹Ø±Ø¶|Ø¹Ø±ÙˆØ¶|Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª)\b/i.test(text)) {
      const offers = await Api.searchOffersAPI(text).catch(() => []);
      if (!offers || offers.length === 0) {
        return { 
          intent: 'search_offers', 
          confidence: 0.85, 
          reply: toneNeutral('Ù…Ø§ Ù„Ù‚ÙŠØª Ø¹Ø±ÙˆØ¶ Ù…Ø·Ø§Ø¨Ù‚Ø©. ØªØ¨ÙŠ Ø£ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ØŸ'), 
          actions: [
            { label: 'Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶', action: 'navigate_analytics' }
          ] 
        };
      }
      return { 
        intent: 'search_offers', 
        confidence: 0.9, 
        data: offers, 
        reply: toneConfirm('Ù„Ù‚ÙŠØª Ù„Ùƒ Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶.'), 
        actions: [
          { label: 'Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶', action: 'navigate_analytics' }
        ] 
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 6ï¸âƒ£ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/\b(Ø·Ù„Ø¨|Ø·Ù„Ø¨Ø§Øª|Ù…Ø·Ù„ÙˆØ¨)\b/i.test(text)) {
      const requests = await Api.searchRequestsAPI(text).catch(() => []);
      if (!requests || requests.length === 0) {
        return { 
          intent: 'search_requests', 
          confidence: 0.85, 
          reply: toneNeutral('Ù…Ø§ Ù„Ù‚ÙŠØª Ø·Ù„Ø¨Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©. ØªØ¨ÙŠ Ø£ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ'), 
          actions: [
            { label: 'Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', action: 'navigate_requests' }
          ] 
        };
      }
      return { 
        intent: 'search_requests', 
        confidence: 0.9, 
        data: requests, 
        reply: toneConfirm(`Ù„Ù‚ÙŠØª Ù„Ùƒ ${requests.length} Ø·Ù„Ø¨.`), 
        actions: [
          { label: 'Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', action: 'navigate_requests' }
        ] 
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 7ï¸âƒ£ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/\b(ØªØ­Ù„ÙŠÙ„|Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª|Ø£Ø±Ù‚Ø§Ù…|Ù†ØªØ§Ø¦Ø¬)\b/i.test(text)) {
      const analytics = await Api.analyticsSummaryAPI().catch(() => null);
      if (analytics) {
        return { 
          intent: 'analytics', 
          confidence: 0.92, 
          data: analytics, 
          reply: toneConfirm('ØªÙØ¶Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©.'), 
          actions: [
            { label: 'ÙØªØ­ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©', action: 'navigate_analytics' }
          ] 
        };
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 8ï¸âƒ£ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/\b(Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…|Ù…ÙˆØ§Ø¹ÙŠØ¯ÙŠ Ø§Ù„ÙŠÙˆÙ…|Ø¥ÙŠØ´ Ø¹Ù†Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…)\b/i.test(text)) {
      const todayAppts = await Api.getTodayAppointmentsAPI().catch(() => []);
      return { 
        intent: 'today_appointments', 
        confidence: 0.95, 
        data: todayAppts, 
        reply: toneConfirm(`Ø¹Ù†Ø¯Ùƒ ${todayAppts.length} Ù…ÙˆØ¹Ø¯ Ø§Ù„ÙŠÙˆÙ….`), 
        actions: [
          { label: 'ÙØªØ­ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…', action: 'navigate_calendar' }
        ] 
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 9ï¸âƒ£ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (/\b(Ø£Ø±Ø´ÙŠÙ|Ø§Ù„Ø£Ø±Ø´ÙŠÙ|Ù…Ù„ÙØ§Øª|Ù…Ø³ØªÙ†Ø¯Ø§Øª)\b/i.test(text)) {
      return { 
        intent: 'archive', 
        confidence: 0.88, 
        reply: toneConfirm('Ø£ÙØªØ­ Ù„Ùƒ ØµÙØ­Ø© Ø§Ù„Ø£Ø±Ø´ÙŠÙØŸ'), 
        actions: [
          { label: 'ÙØªØ­ Ø§Ù„Ø£Ø±Ø´ÙŠÙ', action: 'search_archive' }
        ] 
      };
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ”Ÿ Ø§Ù„Ø±Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // âœ… Ù„Ø§ Ù†Ø±Ø¬Ø¹ reply Ù‡Ù†Ø§ - Ù†Ø®Ù„ÙŠ OpenAI ÙŠØ´ØªØºÙ„
    return { 
      intent: 'unknown', 
      confidence: 0.3, 
      reply: null,  // âœ… null ÙŠØ®Ù„ÙŠ OpenAI ÙŠØ´ØªØºÙ„
      data: null
    };
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¤ EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export default DecisionCoreIntegrated;