# ğŸš€ **Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙƒØ§Ù…Ù„ - Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø´Ø§Ù…Ù„**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                               â•‘
â•‘      ğŸ¯ COMPLETE SHARE SYSTEM IMPLEMENTATION ğŸ¯             â•‘
â•‘                                                               â•‘
â•‘  Ù†Ø¸Ø§Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©              â•‘
â•‘  11 Ù…ÙŠØ²Ø© Ø±Ø¦ÙŠØ³ÙŠØ© + Backend + Frontend + Analytics          â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“ **Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©**

### âœ… Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹:
```
1. /components/SubOfferDetailModal.tsx (Line 1417)
   - Modal ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
   - Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ© Ù…ÙˆØ¬ÙˆØ¯ âœ…

2. /components/ShareOfferModal.tsx
   - Modal Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠ âœ…
   - ÙŠØ¯Ø¹Ù…: WhatsApp, Email, SMS, Facebook
```

### âš ï¸ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø¶Ø§ÙØªÙ‡Ø§:
```
1. /components/MyPlatform.tsx
   - Ù‚Ø³Ù… Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
   - Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙƒÙ„ Ø¹Ø±Ø¶ âŒ

2. /components/owners/MyOffersView.tsx
   - Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø§Ù„Ùƒ
   - Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙƒÙ„ Ø¹Ø±Ø¶ âŒ

3. /components/OffersControlDashboard.tsx
   - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
   - Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ© Ø³Ø±ÙŠØ¹ âŒ
```

---

## ğŸ¯ **Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (11 Ù…ÙŠØ²Ø©)**

### 1ï¸âƒ£ Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ©
### 2ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ ÙƒØªØ§Ù„ÙˆØ¬ PDF
### 3ï¸âƒ£ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (Touch to Copy)
### 4ï¸âƒ£ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
### 5ï¸âƒ£ Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± Ù…Ù†ØµØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
### 6ï¸âƒ£ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
### 7ï¸âƒ£ ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
### 8ï¸âƒ£ Ù…Ø´Ø§Ø±ÙƒØ© Ø¬Ù…Ø§Ø¹ÙŠØ© (Bulk Sharing)
### 9ï¸âƒ£ Ø±Ù…ÙˆØ² QR
### ğŸ”Ÿ Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
### 1ï¸âƒ£1ï¸âƒ£ Ù…ÙŠØ²Ø§Øª Ø°ÙƒÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©

---

## ğŸ“ **Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©**

```
â”œâ”€â”€ Backend (New)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â””â”€â”€ share.controller.ts           â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ watermark.service.ts          â† Ø¬Ø¯ÙŠØ¯ (Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ©)
â”‚   â”‚   â”‚   â”œâ”€â”€ pdf.service.ts                â† Ø¬Ø¯ÙŠØ¯ (PDF)
â”‚   â”‚   â”‚   â”œâ”€â”€ qr.service.ts                 â† Ø¬Ø¯ÙŠØ¯ (QR Codes)
â”‚   â”‚   â”‚   â””â”€â”€ share-analytics.service.ts    â† Ø¬Ø¯ÙŠØ¯ (ØªØ­Ù„ÙŠÙ„Ø§Øª)
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ share.routes.ts               â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚       â””â”€â”€ share.types.ts                â† Ø¬Ø¯ÙŠØ¯
â”‚   â””â”€â”€ prisma/
â”‚       â””â”€â”€ schema.prisma                      â† ØªØ­Ø¯ÙŠØ«
â”‚
â”œâ”€â”€ Frontend
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ShareOfferModal.tsx               â† ØªØ­Ø¯ÙŠØ« ÙƒØ§Ù…Ù„
â”‚   â”‚   â”œâ”€â”€ share/
â”‚   â”‚   â”‚   â”œâ”€â”€ WatermarkSettings.tsx         â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ PDFGenerator.tsx              â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ QRCodeDisplay.tsx             â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ BulkShareModal.tsx            â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ ShareAnalytics.tsx            â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ ContactsManager.tsx           â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ ScheduleShare.tsx             â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”‚   â””â”€â”€ TouchToCopy.tsx               â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”œâ”€â”€ MyPlatform.tsx                    â† Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ©
â”‚   â”‚   â””â”€â”€ owners/
â”‚   â”‚       â””â”€â”€ MyOffersView.tsx              â† Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ©
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useShare.ts                       â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”œâ”€â”€ useWatermark.ts                   â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â”œâ”€â”€ usePDFGenerator.ts                â† Ø¬Ø¯ÙŠØ¯
â”‚   â”‚   â””â”€â”€ useShareAnalytics.ts              â† Ø¬Ø¯ÙŠØ¯
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ api/
â”‚           â””â”€â”€ share.ts                      â† Ø¬Ø¯ÙŠØ¯
```

---

## ğŸ’¾ **1. Database Schema (Prisma)**

```prisma
// Ù…Ù„Ù: backend/prisma/schema.prisma

// Ø¥Ø¶Ø§ÙØ© Models Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©

// ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª
model Share {
  id                String        @id @default(cuid())
  offerId           String
  offer             Property      @relation(fields: [offerId], references: [id], onDelete: Cascade)
  userId            String
  user              User          @relation(fields: [userId], references: [id])
  
  // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
  shareType         ShareType
  platform          SharePlatform
  
  // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  settings          Json?         // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (watermark, etc)
  
  // Ø§Ù„ØªØªØ¨Ø¹
  shareCount        Int           @default(0)
  viewCount         Int           @default(0)
  clickCount        Int           @default(0)
  
  // Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
  shareUrl          String?       @unique
  qrCodeUrl         String?
  pdfUrl            String?
  
  // Ø§Ù„Ø­Ø§Ù„Ø©
  status            ShareStatus   @default(ACTIVE)
  scheduledFor      DateTime?
  expiresAt         DateTime?
  
  // Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø±Ø³Ù„ Ù„Ù‡Ù…
  contacts          ShareContact[]
  
  // Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
  analytics         ShareAnalytic[]
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  @@map("shares")
  @@index([offerId])
  @@index([userId])
  @@index([shareType])
  @@index([platform])
  @@index([createdAt])
}

// Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø¹Ù‡Ù…
model ShareContact {
  id                String        @id @default(cuid())
  shareId           String
  share             Share         @relation(fields: [shareId], references: [id], onDelete: Cascade)
  
  contactName       String?
  contactPhone      String?
  contactEmail      String?
  
  status            ContactStatus @default(SENT)
  sentAt            DateTime      @default(now())
  viewedAt          DateTime?
  clickedAt         DateTime?
  
  @@map("share_contacts")
  @@index([shareId])
}

// ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
model ShareAnalytic {
  id                String        @id @default(cuid())
  shareId           String
  share             Share         @relation(fields: [shareId], references: [id], onDelete: Cascade)
  
  eventType         AnalyticEvent
  eventData         Json?
  ipAddress         String?
  userAgent         String?
  location          String?
  
  createdAt         DateTime      @default(now())
  
  @@map("share_analytics")
  @@index([shareId])
  @@index([eventType])
  @@index([createdAt])
}

// Enums
enum ShareType {
  SINGLE              // Ø¹Ø±Ø¶ ÙˆØ§Ø­Ø¯
  MULTIPLE            // Ø¹Ø¯Ø© Ø¹Ø±ÙˆØ¶
  CATEGORY            // Ù‚Ø³Ù… ÙƒØ§Ù…Ù„
  CUSTOM              // Ù…Ø®ØµØµ
}

enum SharePlatform {
  WHATSAPP
  WHATSAPP_BUSINESS
  TELEGRAM
  FACEBOOK
  INSTAGRAM
  TWITTER
  EMAIL
  SMS
  PDF
  QR_CODE
  DIRECT_LINK
  OTHER
}

enum ShareStatus {
  ACTIVE
  SCHEDULED
  EXPIRED
  CANCELLED
}

enum ContactStatus {
  SENT
  VIEWED
  CLICKED
  CONVERTED
  FAILED
}

enum AnalyticEvent {
  SHARE_CREATED
  SHARE_SENT
  SHARE_VIEWED
  SHARE_CLICKED
  PDF_GENERATED
  QR_GENERATED
  WATERMARK_APPLIED
  LINK_COPIED
  CONTACT_ADDED
}

// ØªØ­Ø¯ÙŠØ« Property model
model Property {
  // ... Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
  
  // Ø¥Ø¶Ø§ÙØ©
  shares            Share[]
  
  // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
}

// ØªØ­Ø¯ÙŠØ« User model
model User {
  // ... Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
  
  // Ø¥Ø¶Ø§ÙØ©
  shares            Share[]
  
  // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
}
```

### Migration:

```bash
# ÙÙŠ: backend/
npx prisma migrate dev --name add_complete_share_system
npx prisma generate
```

---

## ğŸ”§ **2. Backend Services**

### A. Watermark Service

```typescript
// Ù…Ù„Ù: backend/src/services/watermark.service.ts

import sharp from 'sharp';
import path from 'path';
import fs from 'fs';
import { v4 as uuidv4 } from 'uuid';

interface WatermarkOptions {
  showTitle?: boolean;
  showPrice?: boolean;
  showSKU?: boolean;
  showSellerName?: boolean;
  addLogo?: boolean;
  logoPosition?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';
  customText?: string;
}

export class WatermarkService {
  private static UPLOAD_DIR = path.join(__dirname, '../../uploads/watermarked');

  /**
   * Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© Ø¹Ù„Ù‰ ØµÙˆØ±Ø©
   */
  static async addWatermark(
    imagePath: string,
    options: WatermarkOptions,
    offerData: {
      title: string;
      price: number;
      sku: string;
      sellerName: string;
      logo?: string;
    }
  ): Promise<string> {
    try {
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
      if (!fs.existsSync(this.UPLOAD_DIR)) {
        fs.mkdirSync(this.UPLOAD_DIR, { recursive: true });
      }

      // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      const image = sharp(imagePath);
      const metadata = await image.metadata();

      // Ø¥Ù†Ø´Ø§Ø¡ SVG Ù„Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
      const watermarkSvg = this.createWatermarkSVG(
        metadata.width || 800,
        metadata.height || 600,
        options,
        offerData
      );

      // Ø¯Ù…Ø¬ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
      const filename = `watermarked-${uuidv4()}.jpg`;
      const outputPath = path.join(this.UPLOAD_DIR, filename);

      await image
        .composite([
          {
            input: Buffer.from(watermarkSvg),
            top: 0,
            left: 0,
          },
        ])
        .jpeg({ quality: 90 })
        .toFile(outputPath);

      return `/uploads/watermarked/${filename}`;
    } catch (error) {
      console.error('Watermark error:', error);
      throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©');
    }
  }

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ SVG Ù„Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©
   */
  private static createWatermarkSVG(
    width: number,
    height: number,
    options: WatermarkOptions,
    data: any
  ): string {
    const elements: string[] = [];

    // Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´ÙØ§ÙØ©
    elements.push(`
      <rect 
        x="0" 
        y="${height - 100}" 
        width="${width}" 
        height="100" 
        fill="rgba(0, 0, 0, 0.7)"
      />
    `);

    // Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    if (options.showTitle) {
      elements.push(`
        <text 
          x="20" 
          y="${height - 70}" 
          font-family="Arial, sans-serif" 
          font-size="24" 
          font-weight="bold" 
          fill="#FFFFFF"
        >
          ${this.escapeXml(data.title)}
        </text>
      `);
    }

    // Ø§Ù„Ø³Ø¹Ø±
    if (options.showPrice) {
      elements.push(`
        <text 
          x="20" 
          y="${height - 40}" 
          font-family="Arial, sans-serif" 
          font-size="20" 
          font-weight="bold" 
          fill="#D4AF37"
        >
          ${data.price.toLocaleString()} Ø±ÙŠØ§Ù„
        </text>
      `);
    }

    // SKU
    if (options.showSKU) {
      elements.push(`
        <text 
          x="${width - 150}" 
          y="${height - 70}" 
          font-family="Arial, sans-serif" 
          font-size="16" 
          fill="#FFFFFF"
        >
          Ø±Ù‚Ù…: ${data.sku}
        </text>
      `);
    }

    // Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹
    if (options.showSellerName) {
      elements.push(`
        <text 
          x="${width - 150}" 
          y="${height - 40}" 
          font-family="Arial, sans-serif" 
          font-size="14" 
          fill="#CCCCCC"
        >
          ${this.escapeXml(data.sellerName)}
        </text>
      `);
    }

    // Ø§Ù„Ø´Ø¹Ø§Ø±
    if (options.addLogo && data.logo) {
      const logoPosition = this.getLogoPosition(
        width,
        height,
        options.logoPosition || 'top-right'
      );
      elements.push(`
        <image 
          x="${logoPosition.x}" 
          y="${logoPosition.y}" 
          width="80" 
          height="80" 
          href="${data.logo}"
        />
      `);
    }

    return `
      <svg width="${width}" height="${height}">
        ${elements.join('')}
      </svg>
    `;
  }

  private static getLogoPosition(
    width: number,
    height: number,
    position: string
  ): { x: number; y: number } {
    const margin = 20;
    const logoSize = 80;

    switch (position) {
      case 'top-left':
        return { x: margin, y: margin };
      case 'top-right':
        return { x: width - logoSize - margin, y: margin };
      case 'bottom-left':
        return { x: margin, y: height - logoSize - margin };
      case 'bottom-right':
        return { x: width - logoSize - margin, y: height - logoSize - margin };
      default:
        return { x: width - logoSize - margin, y: margin };
    }
  }

  private static escapeXml(str: string): string {
    return str
      .replace(/&/g, '&')
      .replace(/</g, '<')
      .replace(/>/g, '>')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&apos;');
  }

  /**
   * Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¯ÙØ¹Ø© Ù…Ù† Ø§Ù„ØµÙˆØ±
   */
  static async processBatch(
    images: string[],
    options: WatermarkOptions,
    offerData: any
  ): Promise<string[]> {
    const results: string[] = [];

    for (const image of images) {
      try {
        const watermarked = await this.addWatermark(image, options, offerData);
        results.push(watermarked);
      } catch (error) {
        console.error(`Failed to watermark ${image}:`, error);
        results.push(image); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      }
    }

    return results;
  }
}
```

---

### B. PDF Service

```typescript
// Ù…Ù„Ù: backend/src/services/pdf.service.ts

import PDFDocument from 'pdfkit';
import fs from 'fs';
import path from 'path';
import { v4 as uuidv4 } from 'uuid';

interface PDFOptions {
  title: string;
  description: string;
  price: number;
  images: string[];
  sku: string;
  sellerName: string;
  sellerPhone: string;
  sellerEmail: string;
  logo?: string;
  qrCode?: string;
  customFields?: Record<string, string>;
}

export class PDFService {
  private static UPLOAD_DIR = path.join(__dirname, '../../uploads/pdfs');

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ ÙƒØªØ§Ù„ÙˆØ¬ PDF
   */
  static async generateCatalog(options: PDFOptions): Promise<string> {
    try {
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯
      if (!fs.existsSync(this.UPLOAD_DIR)) {
        fs.mkdirSync(this.UPLOAD_DIR, { recursive: true });
      }

      const filename = `catalog-${uuidv4()}.pdf`;
      const outputPath = path.join(this.UPLOAD_DIR, filename);

      // Ø¥Ù†Ø´Ø§Ø¡ PDF
      const doc = new PDFDocument({
        size: 'A4',
        margins: { top: 50, bottom: 50, left: 50, right: 50 },
      });

      const stream = fs.createWriteStream(outputPath);
      doc.pipe(stream);

      // Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ PDF
      await this.addContent(doc, options);

      doc.end();

      // Ø§Ù†ØªØ¸Ø§Ø± Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø©
      await new Promise((resolve) => stream.on('finish', resolve));

      return `/uploads/pdfs/${filename}`;
    } catch (error) {
      console.error('PDF generation error:', error);
      throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF');
    }
  }

  private static async addContent(doc: typeof PDFDocument, options: PDFOptions) {
    // Ø§Ù„Ø£Ù„ÙˆØ§Ù†
    const primaryColor = '#01411C';
    const secondaryColor = '#D4AF37';

    // Header
    if (options.logo) {
      doc.image(options.logo, 50, 50, { width: 100 });
    }

    doc
      .fontSize(28)
      .fillColor(primaryColor)
      .font('Helvetica-Bold')
      .text(options.title, 50, options.logo ? 170 : 50, { align: 'right' });

    doc.moveDown();

    // Ø§Ù„Ø³Ø¹Ø±
    doc
      .fontSize(24)
      .fillColor(secondaryColor)
      .text(`${options.price.toLocaleString()} Ø±ÙŠØ§Ù„`, { align: 'right' });

    doc.moveDown(2);

    // Ø§Ù„ÙˆØµÙ
    doc
      .fontSize(14)
      .fillColor('#000000')
      .font('Helvetica')
      .text(options.description, { align: 'right', width: 500 });

    doc.moveDown(2);

    // Ø§Ù„ØµÙˆØ±
    if (options.images.length > 0) {
      doc
        .fontSize(18)
        .fillColor(primaryColor)
        .font('Helvetica-Bold')
        .text('ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±', { align: 'right' });

      doc.moveDown();

      let yPosition = doc.y;
      const imagesPerRow = 2;
      const imageWidth = 220;
      const imageHeight = 150;
      const spacing = 20;

      for (let i = 0; i < Math.min(options.images.length, 6); i++) {
        const col = i % imagesPerRow;
        const row = Math.floor(i / imagesPerRow);

        const x = 50 + col * (imageWidth + spacing);
        const y = yPosition + row * (imageHeight + spacing);

        try {
          doc.image(options.images[i], x, y, {
            width: imageWidth,
            height: imageHeight,
            fit: [imageWidth, imageHeight],
          });
        } catch (error) {
          console.error(`Failed to add image ${i}:`, error);
        }
      }

      doc.moveDown(10);
    }

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„
    doc.addPage();

    doc
      .fontSize(18)
      .fillColor(primaryColor)
      .font('Helvetica-Bold')
      .text('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„', { align: 'right' });

    doc.moveDown();

    doc
      .fontSize(14)
      .fillColor('#000000')
      .font('Helvetica')
      .text(`Ø§Ù„Ø¨Ø§Ø¦Ø¹: ${options.sellerName}`, { align: 'right' })
      .text(`Ø§Ù„Ù‡Ø§ØªÙ: ${options.sellerPhone}`, { align: 'right' })
      .text(`Ø§Ù„Ø¨Ø±ÙŠØ¯: ${options.sellerEmail}`, { align: 'right' });

    doc.moveDown();

    // QR Code
    if (options.qrCode) {
      doc.moveDown();
      doc
        .fontSize(16)
        .fillColor(primaryColor)
        .text('Ù…Ø³Ø­ QR Code Ù„Ù„Ù…Ø²ÙŠØ¯', { align: 'center' });

      doc.image(options.qrCode, 200, doc.y + 20, { width: 150 });
    }

    // Footer
    doc
      .fontSize(10)
      .fillColor('#666666')
      .text(
        `Ø±Ù‚Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†: ${options.sku}`,
        50,
        doc.page.height - 100,
        { align: 'center' }
      );

    doc.text(
      `ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${new Date().toLocaleDateString('ar-SA')}`,
      50,
      doc.page.height - 80,
      { align: 'center' }
      );
  }

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ PDF Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø¹Ø±ÙˆØ¶
   */
  static async generateMultiCatalog(offers: PDFOptions[]): Promise<string> {
    try {
      if (!fs.existsSync(this.UPLOAD_DIR)) {
        fs.mkdirSync(this.UPLOAD_DIR, { recursive: true });
      }

      const filename = `multi-catalog-${uuidv4()}.pdf`;
      const outputPath = path.join(this.UPLOAD_DIR, filename);

      const doc = new PDFDocument({ size: 'A4' });
      const stream = fs.createWriteStream(outputPath);
      doc.pipe(stream);

      // ØµÙØ­Ø© ØºÙ„Ø§Ù
      doc
        .fontSize(32)
        .fillColor('#01411C')
        .text('ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ©', 50, 300, { align: 'center' });

      doc
        .fontSize(18)
        .fillColor('#D4AF37')
        .text(`${offers.length} Ø¹Ø±Ø¶ Ù…Ù…ÙŠØ²`, 50, 350, { align: 'center' });

      // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ø¹Ø±Ø¶
      for (let i = 0; i < offers.length; i++) {
        doc.addPage();
        await this.addContent(doc, offers[i]);
      }

      doc.end();
      await new Promise((resolve) => stream.on('finish', resolve));

      return `/uploads/pdfs/${filename}`;
    } catch (error) {
      console.error('Multi PDF generation error:', error);
      throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬');
    }
  }
}
```

---

### C. QR Code Service

```typescript
// Ù…Ù„Ù: backend/src/services/qr.service.ts

import QRCode from 'qrcode';
import path from 'path';
import fs from 'fs';
import { v4 as uuidv4 } from 'uuid';

interface QROptions {
  url: string;
  size?: number;
  primaryColor?: string;
  secondaryColor?: string;
  logo?: string;
}

export class QRService {
  private static UPLOAD_DIR = path.join(__dirname, '../../uploads/qr');

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ QR Code
   */
  static async generateQR(options: QROptions): Promise<string> {
    try {
      if (!fs.existsSync(this.UPLOAD_DIR)) {
        fs.mkdirSync(this.UPLOAD_DIR, { recursive: true });
      }

      const filename = `qr-${uuidv4()}.png`;
      const outputPath = path.join(this.UPLOAD_DIR, filename);

      await QRCode.toFile(outputPath, options.url, {
        errorCorrectionLevel: 'H',
        type: 'png',
        width: options.size || 500,
        margin: 2,
        color: {
          dark: options.primaryColor || '#01411C',
          light: options.secondaryColor || '#FFFFFF',
        },
      });

      return `/uploads/qr/${filename}`;
    } catch (error) {
      console.error('QR generation error:', error);
      throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ QR Code');
    }
  }

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ QR Code Ù…Ø¹ Ø´Ø¹Ø§Ø±
   */
  static async generateQRWithLogo(
    url: string,
    logoPath: string
  ): Promise<string> {
    // TODO: Ø¯Ù…Ø¬ Ø§Ù„Ø´Ø¹Ø§Ø± Ù…Ø¹ QR Code Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Sharp
    return this.generateQR({ url });
  }
}
```

---

ÙŠØªØ¨Ø¹ ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø·ÙˆÙ„...

